{% from 'components/btn.jinja' import btn %}

<div id="crear" class="tab-content section-hidden">
  <div class="mt-12 p-8 bg-zinc-900/90 meme-border rounded-3xl max-w-2xl mx-auto backdrop-blur-sm shadow-2xl">
    <h2 class="text-3xl font-extrabold meme-title mb-6 text-yellow-400">CREAR UN NUEVO RETO</h2>
    <form id="createForm" class="space-y-6">
      <div>
        <label class="block text-lg font-bold text-yellow-300 mb-2">TÃ­tulo del Reto</label>
        <input id="inputTitle" type="text" placeholder="Ej: Haz la plancha mÃ¡s Ã©pica"
          class="w-full px-4 py-3 rounded-xl bg-zinc-800 border-2 border-yellow-400/30 text-white placeholder-zinc-500 focus:border-yellow-400 focus:outline-none transition-all">
      </div>
      <div>
        <label class="block text-lg font-bold text-yellow-300 mb-2">DescripciÃ³n del Reto</label>
        <textarea id="inputDescription" placeholder="Describe tu reto Ã©pico aquÃ­..."
          class="w-full px-4 py-3 rounded-xl bg-zinc-800 border-2 border-yellow-400/30 text-white placeholder-zinc-500 focus:border-yellow-400 focus:outline-none transition-all resize-none"
          rows="4"></textarea>
      </div>
      {{ btn('CREAR RETO ðŸš€') }}
    </form>
    <div id="createMessage" class="mt-4 text-center text-green-400 font-bold hidden"></div>
  </div>
</div>

<script type="module" defer>
  // definimos la URL base
  const URL = window.location.href;
  // obtenemos elementos del DOM
  const createForm = document.getElementById('createForm');
  const createMessage = document.getElementById('createMessage');

  // manejador del evento submit del formulario
  createForm.addEventListener('submit', async (e) => {
    // eliminamos el comportamiento por defecto
    e.preventDefault();
    // obtenemos los valores de los campos
    const title = document.getElementById('inputTitle').value;
    const description = document.getElementById('inputDescription').value;
    // validamos que los campos no estÃ©n vacÃ­os
    if (!title || !description) {
      alert('Por favor completa todos los campos');
      return;
    }

    console.log({ title, description })

    try {
      // realizamos la peticiÃ³n POST para crear el reto
      const response = await fetch(`${URL}challenge/create_challenge?title=${encodeURIComponent(title)}&description=${encodeURIComponent(description)}`, { method: 'POST' });
      // manejamos los errores de la respuesta
      if (!response.ok) throw new Error('Error al crear el reto');
      // mostramos el mensaje de Ã©xito
      createMessage.textContent = 'âœ… Â¡Reto creado exitosamente!';
      createMessage.classList.remove('hidden');
      createForm.reset();

      // ocultamos el mensaje despuÃ©s de 3 segundos
      setTimeout(() => {
        createMessage.classList.add('hidden');
      }, 3000);
    } catch (error) {
      // notificamos al usuario
      alert('Error: ' + error.message);
    }
  });
</script>