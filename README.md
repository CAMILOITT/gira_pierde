# Gira Pierde - Proyecto Final

## Descripción General

**Gira Pierde** es una API REST construida con **FastAPI** que permite gestionar una colección de retos o desafíos. Está diseñada para almacenar, recuperar y servir información de retos desde una base de datos PostgreSQL.

## Características

- ✅ Crear nuevos retos
- ✅ Obtener todos los retos disponibles
- ✅ Obtener un reto aleatorio
- ✅ Base de datos PostgreSQL integrada
- ✅ Manejo robusto de errores
- ✅ Rutas documentadas con etiquetas

## Tecnología Stack

- **FastAPI** (v0.124.4+): Framework web moderno para construir APIs REST en Python
- **PostgreSQL**: Base de datos relacional (conectado con `psycopg`)
- **psycopg** (v3.3.2+): Driver de PostgreSQL para Python
- **python-dotenv** (v1.2.1+): Gestor de variables de entorno
- **Ruff** (v0.14.9+): Linter y formateador de código Python

## Instalación

### Prerrequisitos

- Python 3.12 o superior
- pip (gestor de paquetes de Python)

### Pasos de Instalación

1. **Clonar el repositorio**
   ```bash
   git clone <repository-url>
   cd proyecto-final
   ```

2. **Crear un entorno virtual** (opcional pero recomendado)
   ```bash
   python -m venv venv
   source venv/bin/activate  # En Windows: venv\Scripts\activate
   ```

3. **Instalar las dependencias**
   ```bash
   pip install -e .
   ```

4. **Configurar variables de entorno**
   
   Crear un archivo `.env` en la raíz del proyecto:
   ```env
   DATABASE_URL=postgresql://usuario:contraseña@localhost:5432/nombre_base_datos
   ```

5. **Iniciar el servidor**
   ```bash
   fastapi dev ./main.py
   ```
   
   El servidor estará disponible en `http://localhost:8000`

## Estructura del Proyecto

```
proyecto-final/
├── main.py                      # Punto de entrada de la aplicación
├── pyproject.toml              # Configuración del proyecto y dependencias
├── README.md                   # Este archivo
├── .env                        # Variables de entorno (no incluido en git)
├── app/
│   ├── const.py               # Constantes y configuración (conexión BD)
│   ├── routers/
│   │   ├── challenge.py       # Rutas/endpoints de retos
│   │   └── view.py            # Rutas/endpoints de retos
│   └── templates/
│       └── index.html         # Template HTML para la vista principal
└── pierde_muere/              # Colección de pruebas Bruno
    ├── bruno.json
    ├── create_challenge.bru
    ├── get_aleatory_challenge.bru
    └── get_all_challenge.bru
```

## API Endpoints

### 1. Obtener todos los retos
```
GET /challenge/get_all_challenge
```

**Respuesta exitosa (200):**
```json
{
  "challenges": [
    {
      "id": 1,
      "title": "Reto 1",
      "description": "Descripción del reto 1"
    },
    {
      "id": 2,
      "title": "Reto 2",
      "description": "Descripción del reto 2"
    }
  ]
}
```

### 2. Obtener un reto aleatorio
```
GET /challenge/get_aleatory_challenge
```

**Respuesta exitosa (200):**
```json
{
  "challenge": {
    "id": 1,
    "name": "Reto 1",
    "description": "Descripción del reto 1"
  }
}
```

### 3. Crear un nuevo reto
```
POST /challenge/create_challenge?title=<titulo>&description=<descripcion>
```

**Parámetros:**
- `title` (string, requerido): Título del reto
- `description` (string, requerido): Descripción del reto

**Respuesta exitosa (200):**
```json
{
  "message": "El reto fue creado satisfactoriamente",
  "id": 3
}
```

## Base de Datos

### Tabla `challenges`

La aplicación crea automáticamente una tabla con la siguiente estructura:

```sql
CREATE TABLE challenges (
  id INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title VARCHAR(100),
  description TEXT
);
```

**Columnas:**
- `id`: Identificador único (autoincrementado)
- `title`: Título del reto (máximo 100 caracteres)
- `description`: Descripción del reto (texto largo)

## Flujo de Ejecución

1. **Inicialización**: La aplicación carga las variables de entorno desde `.env`
2. **Creación de tablas**: Se crea la tabla `challenges` si no existe
3. **Inicialización de FastAPI**: Se crea la instancia de la aplicación
4. **Registro de rutas**: Se incluye el router de retos a la aplicación principal
5. **Servidor activo**: La API está lista para recibir solicitudes

## Pruebas

El proyecto incluye una colección de pruebas en formato **Bruno** (herramienta API de escritorio) ubicada en `/pierde_muere/`:

- `bruno.json`: Configuración de la colección
- `create_challenge.bru`: Prueba de creación de retos
- `get_all_challenge.bru`: Prueba para obtener todos los retos
- `get_aleatory_challenge.bru`: Prueba para obtener un reto aleatorio

## Manejo de Errores

La aplicación incluye manejo comprehensive de excepciones en todos los endpoints. Los errores se registran en la consola y se devuelven al cliente.

## Desarrollo

### Comandos útiles

- **Iniciar servidor en modo desarrollo**
  ```bash
  fastapi dev ./main.py
  ```

- **Verificar código con Ruff**
  ```bash
  ruff check .
  ```

- **Formatear código con Ruff**
  ```bash
  ruff format .
  ```

## Configuración de Ruff

El proyecto usa Ruff para linting y formateo con la siguiente configuración:
- Longitud de línea: 88 caracteres
- Ancho de indentación: 2 espacios
- Estilo de indentación: espacios
